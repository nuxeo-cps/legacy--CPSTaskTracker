<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/CalendarSelector_main/macros/master">


<metal:block fill-slot="script_plus">
  <script language="JavaScript" type="text/javascript"
    tal:content="string:
  var input_id = '${request/form/input_id}'
  var locale = '${mcat/get_selected_language|string:en}'" />
<script language="JavaScript" type="text/javascript"><!--

function select_day(day,month,year) {
  a = opener.document.getElementById(input_id)
  if (locale == "fr") {a.value = day +'/'+ month + '/' + year}
  else {a.value = month + '/' + day + '/' + year}
  window.close()
}
-->
</script>
</metal:block>



<div metal:fill-slot="header">&nbsp;</div>

<div metal:fill-slot="main">
 <div metal:define-macro="calendarBox"
     class="CalendarBox"
     tal:define="DateTime python:modules['DateTime'].DateTime;
                 yearmonth python:here.getMonthAndYear();
                 year python:yearmonth[0];
                 month python:yearmonth[1];
                 weeks python:here.portal_calendar.getWeeksList(month=month, year=year);
                 input_id request/form/input_id">
<center>
    <!-- The calendar, rendered as a table -->
    <table cellspacing="0" cellpadding="0" border="1">
    <tr><td>

    <table cellpadding="2" cellspacing="0" border="0" class="calendar">

        <tr>

            <!-- The headers.  The month with links either side -->
            <th>
                <a href="#" class="CalendarArrow" tal:attributes="href python:here.getPreviousMonthLink(request.URL0, month, year)+'&input_id='+input_id">&laquo;</a>
            </th>

            <th colspan="5" tal:define="date string:$month/1/$year">
              <span tal:replace="python:mcat('_cmonth_'+DateTime(date).strftime('%m'))"/> <span tal:replace="python:DateTime(date).year()"/>
            </th>

            <th>
                <a href="#" class="CalendarArrow" tal:attributes="href python:here.getNextMonthLink(request.URL0, month, year)+'&input_id='+input_id">&raquo;</a>
            </th>
        </tr>

        <!-- The week days across the top -->
        <tr tal:define="weekdays here/portal_calendar/getDays">
          <tal:weekday tal:repeat="weekday weekdays">
            <td class="weekdays" tal:content="python:mcat('_cday_'+weekday)">Su</td>
          </tal:weekday>
        </tr>

        <!-- The actual days with in the weeks -->
        <tr tal:repeat="week weeks">
          <tal:week tal:define="days week">
            <tal:day tal:repeat="day days">

              <tal:daynumber tal:define="daynumber day;
	                                 we python:repeat['day'].start or repeat['day'].end;">
                    <td tal:condition="not:we">
		      <a tal:attributes="href string:javascript:select_day('${daynumber}', '${month}', '${year}')" tal:content="python: daynumber or default">&nbsp;</a>
		    </td>
		    <td tal:condition="we" bgcolor="#EEEEEE">
		      <a tal:attributes="href string:javascript:select_day('${daynumber}', '${month}', '${year}')" tal:content="python: daynumber or default"></a>
		    </td>
              </tal:daynumber>
            </tal:day>
          </tal:week>
        </tr>

    </table>
    </td></tr>
    </table>
</center>
 </div>
</div>

</html>
